<Window
    x:Class="Cube.Net.App.Rss.Reader.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:dd="urn:gong-wpf-dragdrop"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:xu="clr-namespace:Cube.Xui"
    xmlns:xb="clr-namespace:Cube.Xui.Behaviors"
    xmlns:my="clr-namespace:Cube.Net.App.Rss.Reader"
    
    mc:Ignorable="d"    
    Title="CubeRSS Reader"
    Icon="pack://application:,,,/App.ico"
    FontFamily="Meiryo UI"
    Width="1060"
    Height="630">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Themes/MainStyle.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    
    <Window.DataContext>
        <my:RssViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Sidebar -->
        <Grid Background="#FFEAEAEA">
            <Grid.RowDefinitions>
                <RowDefinition Height="70"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="28"/>
            </Grid.RowDefinitions>

            <StackPanel
                Orientation="Vertical"
                VerticalAlignment="Bottom"
                Margin="0,0,0,16">
                <Button>
                    <Button.Template>
                        <ControlTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Text="&#xf0c5;"
                                    FontFamily="{StaticResource FontAwesome}"
                                    FontSize="16"
                                    Foreground="#FFB3B3B3"
                                    Margin="20,0,8,0"/>
                                <TextBlock
                                    Text="全ての新着記事"
                                    FontSize="12"
                                    FontWeight="Bold"
                                    Foreground="#FF444444"/>
                            </StackPanel>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>

            <TreeView
                x:Name="RssTreeView"
                Background="Transparent"
                BorderThickness="0"
                ItemsSource="{Binding Items}"
                ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                dd:DragDrop.IsDragSource="True"
                dd:DragDrop.IsDropTarget="True"
                dd:DragDrop.DropHandler="{Binding DropTarget}"
                Grid.Row="1">

                <TreeView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel MaxWidth="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ContentPresenter, AncestorLevel=1}}" />
                    </ItemsPanelTemplate>
                </TreeView.ItemsPanel>

                <TreeView.Resources>
                    <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                        <Setter Property="xu:ExpandIconEraser.IsHideExpander" Value="True" />
                    </Style>

                    <!-- Category -->
                    <HierarchicalDataTemplate DataType="{x:Type my:RssCategory}" ItemsSource="{Binding Items}">
                        <StackPanel
                            Orientation="Horizontal"
                            Margin="2,6,0,6">
                            <TextBlock
                                Text="&#xf101;"
                                FontFamily="{StaticResource FontAwesome}"
                                Foreground="#FFB3B3B3"
                                FontSize="16"
                                Margin="0,0,8,0"/>
                            <TextBlock
                                Text="{Binding Title}"
                                FontSize="12"
                                FontWeight="Bold"
                                Foreground="#FF444444"/>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="PreviewMouseRightButtonDown">
                                    <ei:ChangePropertyAction
                                        PropertyName="IsSelected"
                                        Value="true"
                                        TargetObject="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=TreeViewItem}}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <!-- Category -->

                    <!-- Entry -->
                    <HierarchicalDataTemplate DataType="{x:Type my:RssEntry}">
                        <StackPanel
                            Orientation="Horizontal"
                            Margin="2,2,0,2">
                            <TextBlock
                                Text="&#xf0f6;"
                                FontFamily="{StaticResource FontAwesome}"
                                Foreground="#FFB3B3B3"
                                FontSize="16"
                                Margin="0,2,8,0"/>
                            <TextBlock
                                Text="{Binding Title}"
                                FontSize="12"
                                Foreground="#FF444444"
                                Margin="0,2,0,2"/>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="PreviewMouseRightButtonDown">
                                    <ei:ChangePropertyAction
                                        PropertyName="IsSelected"
                                        Value="true"
                                        TargetObject="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=TreeViewItem}}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <!-- Entry -->
                </TreeView.Resources>

                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectedItemChanged">
                        <i:InvokeCommandAction
                            Command="{Binding SelectEntry}"
                            CommandParameter="{Binding SelectedItem, ElementName=RssTreeView}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </TreeView>

            <Button
                Content="&#xf067;"
                Background="#ff662d91"
                BorderThickness="0"
                FontFamily="{StaticResource FontAwesome}"
                Foreground="White"
                Grid.Row="2"/>
        </Grid>
        <!-- Sidebar -->

        <GridSplitter
            HorizontalAlignment="Center"
            Background="#FFF6F6F6"
            BorderThickness="0"
            Width="20"
            Grid.Column="1"/>

        <!-- Feeds-->
        <Grid
            Background="#FFF6F6F6"
            Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="24"/>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border
                Margin="0,2,0,0"
                BorderBrush="#FFE6E6E6"
                BorderThickness="1"
                CornerRadius="2,2,2,2"
                HorizontalAlignment="Right"
                Visibility="{Binding LastChecked.Value, Converter={StaticResource ToVisibility}}">
                <StackPanel
                    Orientation="Horizontal"
                    Background="Transparent">
                    <TextBlock
                        Text="{Binding LastChecked.Value}"
                        FontFamily="Meiryo"
                        FontSize="10"
                        Margin="6,3,0,0"
                        Foreground="#FF999999"/>
                    <Button
                        Content="&#xf01e;"
                        Padding="6,0,6,0"
                        FontSize="14"
                        BorderThickness="0"
                        Background="Transparent"
                        FontFamily="{StaticResource FontAwesome}"
                        Foreground="#FFB3B3B3"/>
                </StackPanel>
            </Border>

            <StackPanel
                Orientation="Horizontal"
                Grid.Row="1">
                <TextBlock
                    Text="{Binding Feed.Value.Title}"
                    Background="Transparent"
                    FontFamily="Meiryo"
                    FontSize="16"
                    FontWeight="Bold"
                    VerticalAlignment="Center"/>
            </StackPanel>

            <ListView
                ItemsSource="{Binding Feed.Value.UnreadItems}"
                Background="Transparent"
                BorderThickness="0"
                SelectionMode="Single"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                ScrollViewer.IsDeferredScrollingEnabled="True"
                ScrollViewer.PanningMode="VerticalOnly"
                VirtualizingPanel.IsVirtualizing="True"
                VirtualizingPanel.VirtualizationMode="Recycling"
                Grid.Row="2">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border
                            BorderThickness="0,0,1,1"
                            BorderBrush="#FFE6E6E6">
                            <StackPanel
                                Background="White"
                                Margin="0"
                                Orientation="Vertical"
                                HorizontalAlignment="Stretch">
                                <TextBlock
                                    Text="{Binding PublishTime, StringFormat=yyyy/MM/dd hh:mm:ss}"
                                    Margin="12,8,12,0"
                                    FontFamily="Meiryo"
                                    FontSize="8"
                                    Foreground="#FF999999"
                                    HorizontalAlignment="Right"/>
                                <TextBlock
                                    Text="{Binding Title}"
                                    MaxHeight="40"
                                    Margin="12,8,12,0"
                                    FontFamily="Meiryo"
                                    FontSize="12"
                                    FontWeight="Bold"
                                    Foreground="#FF4D4D4D"
                                    TextWrapping="Wrap"
                                    TextTrimming="WordEllipsis"/>
                                <TextBlock
                                    Text="{Binding Summary}"
                                    MaxHeight="48"
                                    Margin="12,8,12,8"
                                    FontFamily="Meiryo"
                                    FontSize="10"
                                    LineHeight="10"
                                    Foreground="#FF838383"
                                    TextWrapping="Wrap"
                                    TextTrimming="WordEllipsis"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0,0,4,4"/>
                    </Style>
                </ListView.ItemContainerStyle>
                <i:Interaction.Behaviors>
                    <xb:ListBoxSelectItems Command="{Binding SelectArticle}"/>
                </i:Interaction.Behaviors>
            </ListView>
        </Grid>
        <!-- Feeds -->

        <GridSplitter
            HorizontalAlignment="Center"
            Background="#FFF6F6F6"
            BorderThickness="0"
            Width="20"
            Grid.Column="3"/>
        
        <!-- Preview -->
        <Grid
            Background="White"
            Grid.Column="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Button
                x:Name="SettingsButton"
                Content="&#xf0c9;"
                Padding="16,0,16,0"
                FontSize="18"
                BorderThickness="0"
                Background="Transparent"
                FontFamily="{StaticResource FontAwesome}"
                Foreground="#FF666666"
                HorizontalAlignment="Right"
                ContextMenuService.IsEnabled="False">
                <Button.ContextMenu>
                    <ContextMenu
                        Background="White"
                        HorizontalOffset="-140">
                        <MenuItem Header="インポート"/>
                        <MenuItem Header="エクスポート"/>
                        <Separator/>
                        <MenuItem Header="設定"/>
                        <MenuItem Header="バージョン情報"/>
                        <Separator/>
                        <MenuItem Header="終了"/>
                    </ContextMenu>
                </Button.ContextMenu>
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Click">
                        <ei:ChangePropertyAction
                            TargetObject="{Binding ContextMenu, ElementName=SettingsButton}" 
                            PropertyName="IsOpen"
                            Value="True"/>
                        <ei:ChangePropertyAction
                            TargetObject="{Binding ContextMenu, ElementName=SettingsButton}" 
                            PropertyName="PlacementTarget" 
                            Value="{Binding ElementName=SettingsButton, Mode=OneWay}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </Button>

            <WebBrowser Grid.Row="1">
                <i:Interaction.Behaviors>
                    <xb:WebDocument Text="{Binding Content.Value}"/>
                </i:Interaction.Behaviors>
            </WebBrowser>
        </Grid>
        <!-- Preview -->
    </Grid>
</Window>
